# Story 2.4: Genetic Algorithm Mutation and Termination

**Status:** Draft

## Goal & Context

**User Story:** As a user, I want the genetic algorithm to apply mutation to strategies and determine when to terminate the evolution process based on criteria like maximum generations or convergence so that the system efficiently identifies optimal trading strategies without unnecessary computation.

**Context:** This story completes the GA evolution cycle from Story 2.3 by incorporating mutation for exploration and implementing termination logic to end runs when predefined conditions are met, ensuring resource efficiency and timely results for strategy discovery.

## Detailed Requirements

- Implement mutation operations to randomly alter rules in offspring strategies, such as changing indicators, operators, or values, while respecting configuration constraints.
- Define termination conditions based on `config.yaml` (e.g., fixed generations, no improvement threshold, or diversity metrics).
- Log mutation events and termination reasons for transparency and debugging.
- Ensure the GA saves the final population and best strategies upon termination.
- Integrate with checkpointing to allow resuming if termination is not final.

## Acceptance Criteria (ACs)

- AC1: Mutation is applied to a configurable percentage of offspring, introducing variations without breaking strategy validity.
- AC2: The GA accurately checks termination conditions after each generation.
- AC3: Upon termination, the system outputs the best strategies and associated metrics.
- AC4: Logs include details of mutations performed and the reason for termination.
- AC5: The process handles edge cases, like immediate termination if initial population is optimal.
- AC6: Final GA state is saved, including the hall of fame strategies.
- AC7: The implementation is optimized to minimize runtime for large-scale evolutions.

## Technical Implementation Context

**Guidance:** Use the following details for implementation.

- **Relevant Files:**
  - Files to Create: `src/adaptive_trading_system/ga/mutation.py`, `tests/unit/ga/test_mutation.py`
  - Files to Modify: `src/adaptive_trading_system/ga/engine.py` (add mutation and termination logic), `src/adaptive_trading_system/config/settings.py` (define termination configs), `docs/data-models.md` (update GA logs)

- **Key Technologies:**
  - DEAP for mutation functions
  - Custom logic for termination checks

- **API Interactions / SDK Usage:**
  - Leverage DEAP's mutation tools, customized for strategy rules.

- **UI/UX Notes:** Provide console summaries at termination, e.g., best strategy fitness.

- **Data Structures:** Extend `GAIndividual` for mutated states.

- **Environment Variables:** None specific.

- **Coding Standards Notes:** Use random seeding for reproducibility in mutations.

## Tasks / Subtasks

- [ ] Develop mutation functions for strategy rules.
- [ ] Implement termination condition checks.
- [ ] Integrate mutation into the GA loop and test.
- [ ] Add logging for mutation and termination events.

## Testing Requirements

- **Unit Tests:** Test mutation outcomes and termination triggers.
- **Integration Tests:** Simulate full GA runs to verify proper termination.

## Story Wrap Up

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {}
- **Change Log:** {}