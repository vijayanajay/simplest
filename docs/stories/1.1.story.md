# Story 1.1: System Setup & Configuration

**Status:** Draft

## Goal & Context

**User Story:** As a user, I want to easily configure the system (e.g., list of Indian large/mid-cap NSE stocks or criteria for selection, date range, basic GA parameters, feature families to include, heuristic thresholds) via a configuration file so that I can tailor the discovery process to my specific needs without overcomplicating the configuration process. I also want to run the system on my local Windows machine with minimal setup hassle so that I can get started quickly.

**Context:** This story establishes the fundamental entry point and configuration mechanism for the system. It defines how users will initiate a run and how the system will consume parameters, laying the groundwork for all subsequent components which will rely on this configuration. It also addresses the initial setup experience for local Windows environments.

## Detailed Requirements

- Implement a Command Line Interface (CLI) using Typer/Click for initiating runs (e.g., `tradefinder discover --config-file config.yaml`).
- Design and implement the `config.yaml` structure to include essential user-facing parameters as defined in the PRD User Stories and Configuration NFR (stock list, date range, feature selection, basic GA settings, heuristic thresholds, min profitable stocks).
- Implement configuration loading and parsing logic.
- Implement robust validation for the `config.yaml` structure and values (e.g., using Pydantic) with clear error messages.
- Implement structured logging (e.g., JSON format) with context (module, function, run ID).
- Log the full effective configuration used for each run.
- Provide clear, step-by-step setup instructions for setting up a local Python environment (e.g., using `venv`) and installing dependencies from a `requirements.txt` file.
- Ensure the system runs successfully within a standard local Python environment on Windows.

## Acceptance Criteria (ACs)

- AC1: The system can be initiated via a CLI command specifying a configuration file.
- AC2: The system successfully loads and parses parameters from a valid `config.yaml` file.
- AC3: The system provides clear, user-friendly error messages for invalid or malformed `config.yaml` files.
- AC4: The system logs are structured (e.g., JSON lines) and include relevant context like run ID.
- AC5: The full configuration used for a run is logged at the start of the run.
- AC6: Setup instructions clearly guide a user to install dependencies in a virtual environment.
- AC7: The system executes the initial steps (e.g., config loading, logging setup) successfully on a local Windows machine with the specified dependencies installed.

## Technical Implementation Context

**Guidance:** Use the following details for implementation. Refer to the linked `docs/` files for broader context if needed.

- **Relevant Files:**
  - Files to Create: `src/adaptive_trading_system/cli/commands.py`, `src/adaptive_trading_system/config/settings.py`, `src/adaptive_trading_system/main.py`, `config/default_config.yaml`, `config/user_config_example.yaml`, `docs/environment-vars.md`, `docs/project-structure.md`, `docs/coding-standards.md`, `docs/testing-strategy.md`, `README.md` (for setup instructions), `.env.example`, `.gitignore`
  - Files to Modify: `pyproject.toml` (for CLI entry point, dependencies), `.gitignore` (add `reports/`, `data/cache/`, `state/`, `.env`)
  - _(Hint: See `docs/project-structure.md` for overall layout)_

- **Key Technologies:**
  - Python 3.10+
  - Typer / Click (for CLI)
  - PyYAML (for config parsing)
  - Pydantic (for config validation)
  - Python `logging` module (for structured logging)
  - `structlog` (optional, for easier structured logging)
  - `python-dotenv` (optional, for loading `.env` file)
  - `venv` or similar (for environment setup instructions)
  - _(Hint: See `docs/tech-stack.md` for full list)_

- **API Interactions / SDK Usage:**
  - N/A (This story focuses on internal setup and config loading, not external APIs).

- **UI/UX Notes:** ONLY IF THIS IS A UI Focused Epic or Story
  - Focus on clear console output for logging and error messages.
  - Ensure CLI help text is informative (Typer/Click handles much of this).

- **Data Structures:**
  - Define Pydantic models for the `config.yaml` structure in `src/adaptive_trading_system/config/settings.py`. Refer to the `CLIConfiguration` model concept in `docs/data-models.md`.
  - _(Hint: See `docs/data-models.md` for key project data structures)_

- **Environment Variables:**
  - Document potential environment variables like `APP_ENV`, `APP_LOG_LEVEL`, `CACHE_DB_PATH` in `docs/environment-vars.md`.
  - Ensure the system can read these variables using `os.environ.get()`.
  - Create an `.env.example` file.
  - _(Hint: See `docs/environment-vars.md` for all variables)_

- **Coding Standards Notes:**
  - Adhere to PEP 8, use type hints (MyPy), docstrings.
  - Implement robust error handling for file I/O and configuration parsing, raising specific exceptions (e.g., `ConfigurationError` from `src/adaptive_trading_system/common/exceptions.py`).
  - Use structured logging format as defined in `docs/coding-standards.md`.
  - _(Hint: See `docs/coding-standards.md` for full standards)_

## Tasks / Subtasks

- [ ] Design the `config.yaml` schema based on PRD requirements.
- [ ] Create Pydantic models for the configuration in `src/adaptive_trading_system/config/settings.py`.
- [ ] Implement configuration loading and parsing logic using PyYAML and Pydantic.
- [ ] Implement robust configuration validation with clear error messages.
- [ ] Set up structured logging configuration (console and file output).
- [ ] Implement the main CLI entry point using Typer/Click in `src/adaptive_trading_system/cli/commands.py`.
- [ ] Integrate config loading and logging setup into the main application flow (`src/adaptive_trading_system/main.py`).
- [ ] Log the effective configuration at the start of the run.
- [ ] Write clear, step-by-step setup instructions in `README.md` covering Python environment setup and dependency installation.
- [ ] Create `.env.example` and update `.gitignore`.

## Testing Requirements

**Guidance:** Verify implementation against the ACs using the following tests.

- **Unit Tests:**
  - Write unit tests for config loading and validation logic (`tests/unit/config/test_settings.py`). Test valid configs, invalid types, missing required fields, extra fields.
  - Write unit tests for logging setup to ensure correct formatting and handlers.
- **Integration Tests:**
  - Write an integration test (`tests/integration/test_config_cli_integration.py`) that invokes the CLI with a sample config file and verifies that the config is loaded correctly and the initial logging output is as expected (check log file content).
- **Manual/CLI Verification:**
  - Run the CLI with a valid sample config. Verify console output and log file content.
  - Run the CLI with an invalid config (e.g., wrong data type, missing field). Verify clear error messages are displayed and the program exits gracefully.
  - Follow the setup instructions in `README.md` on a Windows machine to ensure they are accurate and complete.
- _(Hint: See `docs/testing-strategy.md` for the overall approach)_

## Story Wrap Up (Agent Populates After Execution)

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Completion Notes:** {Any notes about implementation choices, difficulties, or follow-up needed}
- **Change Log:** {Track changes _within this specific story file_ if iterations occur}
  - Initial Draft
